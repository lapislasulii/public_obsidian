
## Конспект лекции: Аппаратное обеспечение. Слой Servers

Данная лекция посвящена слою **Servers** (аппаратные платформы для вычислений) в референтной модели облачных вычислений **NIST**.

### 1. История архитектур и основные идеи

История современного компьютинга начинается с **Джона фон Неймана** в 1945 году. Его революционная идея заключалась в отделении программ (алгоритмов) от архитектуры вычислительной машины. До этого программы реализовались аппаратно.

Состав вычислительной платформы включает: вычислитель (CPU), ОЗУ (оперативное запоминающее устройство), ПЗУ (постоянное запоминающее устройство), устройства ввода/вывода и шины передачи данных.

**Подходы к хранению данных в памяти (по структуре архитектуры):**

|Архитектура|Описание|Применение и особенности|
|:--|:--|:--|
|**Принстонская (фон Неймана)**|Использует общую шину для данных и команд (кода) в одной памяти.|**Плюсы:** Эффективное использование памяти, не ограничивает объем памяти. **Минус:** Узкое место — шина данных, замедление, так как чтение данных и инструкций затруднено. Используется во внешней структуре большинства платформ и процессоров.|
|**Гарвардская**|Память для данных и память для инструкций физически разделены.|**Плюсы:** Быстродействие, возможность независимой работы с инструкциями (предвыборка). **Минусы:** Несколько шин, ограничения по объему памяти, сложная логическая синхронизация двух памятей. Используется во внутренней структуре современных высокопроизводительных процессоров, например, в кэш-памяти первого уровня (L1).|

В современных вычислительных машинах используются обе архитектуры одновременно (комбинированный подход).

### 2. Компоновка компонентов

**Модульная архитектура (IBM PC, 1981):** Идея состоит в декомпозиции аппаратной начинки на части и стандартизации интерфейсов, позволяя собирать платформу как конструктор.

**Основные компоненты модульной системы**: CPU (*N), материнская плата, память, диски, блок питания (*2 на серверных платформах), видеокарта (*N), корпус, сетевые интерфейсы, контроллеры дисковой подсистемы.

**Материнская плата** является центром системы. На ней реализованы шины, ПЗУ, цепи питания, тактовые генераторы, сокеты и разъемы.

- **Чипсеты (Мосты):**
    - **Северный мост (Northbridge):** Раньше был отдельным чипом, взаимодействовал с оперативной памятью, графическими интерфейсами (PCI Express). Сейчас в основном **интегрирован в сам процессор** (началось с AMD Fusion, затем Intel Nehalem).
    - **Южный мост (Southbridge):** Отвечал за медленные периферийные устройства (SATA, USB, аудио, сеть). Существует и сейчас, называясь **PCH** (Platform Controller Hub) у Intel или **FCH** (Fusion Controller Hub) у AMD.
- **Микропрограммы (BIOS/UEFI):** Хранятся на ПЗУ материнской платы.
    - **BIOS (Basic Input-Output System):** Работает в 16-битном режиме, поддерживает загрузку с дисков не более 2,1 Тб.
    - **UEFI (Unified Extensible Firmware Interface):** Предложен в 2007 году. Может работать в 32- или 64-битном режимах, поддерживает загрузку с дисков более 2,2 Тб (до 9,4 зеттабайт), обладает обратной совместимостью с BIOS и функцией безопасного запуска (Secure Boot).

**Система на чипе (System On a Chip, SoC):** Концепция, при которой не только видеоядро и контроллеры, но и сама периферия (включая модемы) затащены в одну микросхему (например, Snapdragon, Qualcomm, Apple M-серия, NVIDIA Spark). SoC повышает энергоэффективность и производительность, но делает устройства менее ремонтопригодными и затрудняет модульные апгрейды.

### 3. Центральный процессор (CPU)

Термин **"архитектура процессора"** имеет три контекста:

1. **Подход к разработке (Высокоуровневая идеология):** CISC, RISC, MISC, VLIW.
2. **Набор команд (Ассемблер):** X86-64 (Intel 64, AMD64), ARM64.
3. **Специфика конкретного семейства чипов:** Различия в объеме кэша, количестве ядер, аппаратно реализованных функциях.

#### Высокоуровневые архитектуры:

1. **CISC (Complex Instruction Set Computer):** Компьютер с полным набором команд.
    - Примеры: AMD, Intel (X86-64).
    - Имеет большой набор сложных, аппаратно реализованных команд (например, AES шифрование).
    - Программы короткие, разработка проще, но каждая команда выполняется сравнительно медленно. Имеют проблемы с тепловыделением и энергопотреблением.
2. **RISC (Reduced Instruction Set Computer):** Компьютер с сокращенным набором команд.
    - Примеры: ARM, Apple M-серия.
    - Использует маленький, ограниченный набор элементарных команд.
    - Программы длиннее, но каждая команда выполняется быстрее. Более энергоэффективные, что важно для мобильных устройств и сверхплотных ЦОД.
3. **MISC (Minimal Instruction Set Computer):** Специализированный RISC для встраиваемых систем, IoT, роботов. Умеет выполнять ограниченное количество команд.
4. **VLIW (Very Long Instruction Word):** Использует очень длинные и сложные команды (CISC, доведенный до абсолюта). Позволяет достигать высокого перформанса без необходимости использования сверхмелкого технологического процесса (актуально для российских процессоров "Эльбрус"). Минус: ассемблеры от поколения к поколению несовместимы, сильная зависимость от эффективности компилятора.

#### Топология и особенности CPU:

- **Ядра и потоки:** Процессоры различаются по количеству **физических ядер** и **логических ядер (гиперпотоков)**.
- **APIC (Advanced Programmable Interrupt Controller):** Устройство в составе процессора, отвечающее за работу с прерываниями. Каждый логический процессор имеет свой APIC ID, который используется ОС для идентификации ядра и присвоения ему процессов.
- **Сокеты:** Разъемы для подключения процессора. Сокеты несовместимы между поколениями (особенно часто у Intel).
- **Кэш-память** (уровни, чем меньше номер, тем быстрее и ближе к ядру):
    - **L1 (Уровень 1):** Самый быстрый. Делится на **L1D** (для данных) и **L1I** (для инструкций) (пример Гарвардской архитектуры). Принадлежит конкретному ядру.
    - **L2 (Уровень 2):** Кэш для ядра, быстрее L3.
    - **L3 (Уровень 3):** Общий кэш для всего процессора (сокета), самый большой по объему.
- **TDP (Тепловая мощность проектирования):** Максимальное количество тепла, генерируемое чипом, которое система охлаждения должна рассеять. Важно для конструирования охлаждения и оценки энергопотребления.
    - **Троттлинг:** Современные платформы понижают тактовую частоту процессора, если система перегревается.
- **Конвейер команд:** Метод, позволяющий нескольким инструкциям находиться на разных стадиях выполнения одновременно (выборка, декодирование, выполнение). Позволяет процессорам переупорядочивать инструкции для оптимизации.
- **Аппаратное предсказание ветвлений:** Сложная система, которая заранее рассчитывает две цепочки событий условного оператора (спекулятивное выполнение) для минимизации задержек.

### 4. Графический процессор (GPU)

GPU – специализированный чип с собственной архитектурой, предназначенный для параллельной обработки данных.

**Архитектура и назначение**:

- **NVIDIA** использует архитектуру **CUDA** (Compute Unified Device Architecture).
- **Цель:** Обеспечить максимально высокий уровень параллелизма, что идеально подходит для рендеринга графики, симуляций и **машинного обучения** (ML).
- **Структура:** GPU состоит из гигантского количества **потоковых процессоров (ядер)**. Ядра специализированные и умеют выполнять ограниченное количество математических операций (умножение матриц, работа с векторами).
- **Память (VRAM):** Быстрая видеопамять, расположенная прямо на устройстве, которая используется для оперирования данными.
- **Отличие от CPU:** Если CPU имеет несколько мощных ядер, способных выполнять широкий спектр задач общего назначения, то GPU имеет тысячи менее универсальных, но высокоспециализированных ядер, объединенных в блоки (thread blocks) и сетки (GRID), работающих параллельно, что обеспечивает сумасшедшую скорость при матричных операциях.

### 5. Оперативная память (RAM)

Производительность системы драматически зависит от RAM.

**Характеристики RAM**:

- **Тип:** DDR3, DDR4, DDR5 (DDR5 лучше, так как имеет бо́льшую пропускную способность и объем, но меньшее напряжение).
- **Объем, Частота, Тайминги.**
- **Форм-фактор:** DIMM (для десктопов/серверов), SO-DIMM (для ноутбуков).
- **Каналы:** У DDR5 два 32-битных канала, что позволяет работать двум параллельным шинам, увеличивая скорость.

**Тайминги (в тактах):** Время от отправки команды до ее исполнения. Самый важный показатель — **CAS Latency (CL)**. Итоговая скорость памяти зависит от частоты, таймингов и количества каналов.

_Важно:_ Для достижения лучших показателей памяти, необходимо, чтобы процессор и материнская плата также соответствовали, так как **контроллер памяти находится внутри CPU**.

### 6. Форм-факторы серверных платформ

1. **Tower:** Обычные системные блоки (напольные).
2. **Rack-mount (Стоечные):** Серверы, предназначенные для установки в стойки. Измеряются в юнитах (U), где 1U примерно 1,75 дюйма (~4,5 см). Характеризуются дублированием блоков питания (БП), контроллерами и специфической компоновкой для охлаждения.
3. **Блейд-системы (Blade systems):** Состоят из **Шасси** (корпус, дающий питание и сеть) и **Блейд-серверов (лезвий)**. Каждое лезвие — отдельный сервер без собственных БП или вентиляторов.
    - **Преимущества:** Высокая компактность и гиперконвергентная архитектура.
    - **Недостатки:** Катастрофический **вендерлок** (привязка к одному производителю).

[[Лек 2. Слой Servers.pdf]]
[[Лек 7. Объектное хранение.pdf]]
# Конспект лекции: Слой хранения (Объектное хранение и S3)

### 1. Место хранения в ИТ-инфраструктуре

Слой **Storage (Хранение)** является одним из ключевых уровней ИТ-инфраструктуры, находясь в одном ряду с серверами, сетями, виртуализацией, операционными системами и приложениями.

**Основные задачи слоя хранения:**

- Непосредственное **хранение данных**.
- Обеспечение **надежности** и **безопасности** данных.
- Поддержание **производительности** в соответствии с требованиями конкретных приложений.
- **Масштабирование** системы по мере роста объема данных.
- Поддержка **версионирования** объектов.
- Обеспечение **экономической эффективности** использования ресурсов.

### 2. Классификация систем хранения данных

Традиционно выделяют три основных типа хранения:

1. **Блочное хранение:** представлено дисками, системами DAS (Direct Attached Storage) и SAN (Storage Area Network).
2. **Файловое хранение:** включает файловые системы и решения NAS (Network Attached Storage).
3. **Объектное хранение:** примером которого является протокол **S3**.

### 3. Объектное хранилище S3 (Simple Storage Service)

Данные — самый ценный актив современных информационных систем, поэтому на уровне хранения применяются различные техники обеспечения избыточности.

**S3** — это объектное хранилище, предназначенное для работы с **неструктурированными данными** любого типа и объема (изображения, видео, логи, архивы).

**Ключевые отличия и особенности S3:**

- **Плоская модель данных:** В отличие от иерархических файловых систем с папками, S3 использует плоскую структуру, где каждый объект имеет уникальный ключ.
- **Доступ через API:** Взаимодействие происходит через REST API по протоколам HTTP/HTTPS.
- **Масштабируемость:** Обеспечивает высокую масштабируемость и простоту доступа.
- **Надежность:** Данные автоматически реплицируются между несколькими узлами для защиты от сбоев.

### 4. Основные сущности S3

Архитектура S3 строится на нескольких базовых понятиях:

- **Бакет (Bucket):** Логический контейнер для объектов. Имеет глобально уникальное имя. Внутри бакета отсутствует реальная иерархия.
- **Объект (Object):** Базовая единица данных. Включает в себя сам файл (размером до **5 ТБ**), метаданные и уникальный ключ. Объекты атомарны.
- **Ключ (Key):** Уникальный идентификатор объекта внутри бакета (строка UTF-8 до 1024 байт). Он определяет «путь» к объекту, хотя физической вложенности нет.
- **Префикс (Prefix):** Начальная часть ключа, которая используется для логической группировки объектов и имитации папок (например, `logs/2025/`).
- **Классы хранения:** Используются для оптимизации затрат. Различают **горячее, теплое и холодное** хранение в зависимости от частоты доступа к данным.

### 5. Преимущества использования S3

- **Аутентификация:** Доступ осуществляется через ключи доступа.
- **Стандартные операции:** Поддержка PUT (загрузка), GET (скачивание), DELETE (удаление) и LIST (вывод списка).
- **Автоматизация:** Возможность настройки **lifecycle-политик** для автоматического удаления или перемещения старых данных.
- **Интеграция:** Легко интегрируется с облачными сервисами (например, AWS Lambda, EC2).
- **Экономика:** Модель оплаты «по факту использования».

### 6. Популярные S3-решения

S3 — это не только сервис Amazon, но и стандарт архитектуры и API.

**Open Source решения:**

- **MinIO:** Высокопроизводительное хранилище для on-premise и контейнерных сред.
- **Ceph (RADOS Gateway):** Распределенная система, масштабируемая до тысяч узлов.
- **Scality S3server:** Легкое решение для тестирования S3-приложений локально.
- **s3fs:** Позволяет монтировать бакеты S3 как локальные диски в Linux/macOS.

**Облачные провайдеры:**

- **Amazon S3:** Оригинальный сервис от AWS.
- **Yandex Cloud Object Storage:** Российский сервис с поддержкой шифрования и жизненных циклов.
- **VK Cloud S3:** Подходит для бэкапов, медиа-контента и данных машинного обучения.
- **Selectel / Cloud4Y:** Российские провайдеры с фокусом на соответствие законодательству (152-ФЗ) и прозрачную тарификацию.
- **Cloudflare R2:** Отличается отсутствием платы за исходящий трафик (egress).

### 7. Инструменты для работы с S3

Для управления данными в объектных хранилищах используются разные подходы:

1. **Веб-консоль:** Графический интерфейс провайдера (AWS, Yandex Cloud).
2. **CLI (Command Line Interface):** Официальные утилиты для командной строки (например, `aws s3`), требующие предварительной конфигурации ключей.
3. **Специализированные утилиты:** `s3cmd` или `rclone` (поддерживает синхронизацию и монтирование).
4. **SDK:** Библиотеки для разработки приложений (например, **boto3** для Python).
5. **IaC (Infrastructure as Code):** Автоматизация через **Terraform** или **Ansible**.

### 8. Примеры команд CLI (на примере Yandex Cloud)

- **Просмотр списка бакетов:** `aws s3 ls --endpoint-url=https://storage.yandexcloud.net`
- **Создание нового бакета:** `aws s3 mb s3://my-new-bucket --endpoint-url=https://storage.yandexcloud.net`
- **Загрузка директории (рекурсивно):** `aws s3 cp mydir/ s3://my-bucket/ --recursive --endpoint-url=https://storage.yandexcloud.net`
- **Синхронизация локальной папки с бакетом:** `aws s3 sync localdir/ s3://my-bucket/ --endpoint-url=https://storage.yandexcloud.net`
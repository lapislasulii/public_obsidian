# Дифференциал композиции, матрица Якоби и уравнения в частных производных

## Обзор семинара

Семинар посвящён правилам дифференцирования отображений нескольких переменных. Основная тема — вычисление матрицы Якоби и дифференциала для: полярных и сферических координат, композиции $f \circ g$ с произвольной дифференцируемой функцией $f$, а также явно заданной композиции с перемножением матриц Якоби. Отдельно разобрана задача на проверку того, что семейство функций удовлетворяет уравнению в частных производных, — задача, связывающая тему сложной функции с дифференциальными уравнениями.

---

## Методы и подходы

### 1. Матрица Якоби и якобиан отображения

**Когда применять:** для любого дифференцируемого отображения $f : \mathbb{R}^m \to \mathbb{R}^n$, когда требуется найти производную (матрицу Якоби) или вычислить дифференциал.

**Определение.** Пусть $f = (f_1, \ldots, f_n)$, аргументы $x_1, \ldots, x_m$. Матрица Якоби:

$$
f'(x) = J_f =
\begin{pmatrix}
\dfrac{\partial f_1}{\partial x_1} & \cdots & \dfrac{\partial f_1}{\partial x_m} \\\\
\vdots & \ddots & \vdots \\\\
\dfrac{\partial f_n}{\partial x_1} & \cdots & \dfrac{\partial f_n}{\partial x_m}
\end{pmatrix}
$$

По строкам расположены функции, по столбцам — переменные дифференцирования.

**Якобиан** — это определитель матрицы Якоби: $\det f'(x)$. Он существует только когда матрица квадратная, то есть $m = n$.

**Алгоритм:**
1. Выписать все функции на выходе: $f_1, \ldots, f_n$.
2. Выписать все переменные на входе: $x_1, \ldots, x_m$.
3. Заполнить матрицу: элемент $(i,j)$ равен $\dfrac{\partial f_i}{\partial x_j}$.
4. Если требуется якобиан — вычислить определитель.

**Пример: полярные координаты** (задача 13, вариант из листка).

Отображение $f : (\rho, \varphi) \to (x, y)$:
$$x = \rho\cos\varphi, \quad y = \rho\sin\varphi.$$

Матрица Якоби:
$$
J_f =
\begin{pmatrix}
\dfrac{\partial x}{\partial \rho} & \dfrac{\partial x}{\partial \varphi} \\\\
\dfrac{\partial y}{\partial \rho} & \dfrac{\partial y}{\partial \varphi}
\end{pmatrix}
=
\begin{pmatrix}
\cos\varphi & -\rho\sin\varphi \\\\
\sin\varphi & \rho\cos\varphi
\end{pmatrix}
$$

Якобиан:
$$
\det J_f = \cos\varphi \cdot \rho\cos\varphi - (-\rho\sin\varphi)\cdot\sin\varphi = \rho\cos^2\varphi + \rho\sin^2\varphi = \rho.
$$

**Геометрический смысл якобиана:** якобиан — коэффициент изменения площади (объёма) при замене координат. Для полярных координат он равен $\rho$: чем дальше от нуля, тем сильнее растягивается площадь.

**ЛОВУШКИ:**
- Якобиан и матрица Якоби — разные объекты. Якобиан — число (определитель), матрица Якоби — сама матрица.
- В матрице $2 \times 2$ определитель: $\det\begin{pmatrix}a & b \\ c & d\end{pmatrix} = ad - bc$. Не перепутать знак.
- У некватратной матрицы якобиан не определён.

**ПРИЗНАКИ ПРИМЕНИМОСТИ:** задача содержит слова «найти матрицу Якоби», «найти якобиан», «вычислить дифференциал отображения».

---

### 2. Дифференциал отображения в точке на векторе смещения

**Когда применять:** когда задана точка $M$ и вектор $\vec{h}$ и требуется вычислить $df(M, \vec{h})$.

**Формула:**
$$
df(M, \vec{h}) = f'(M) \cdot \vec{h},
$$
то есть матрица Якоби, вычисленная в точке $M$, умноженная на столбец $\vec{h}$.

**Алгоритм:**
1. Вычислить матрицу Якоби $f'(x)$ в общем виде.
2. Подставить координаты точки $M$ в матрицу.
3. Умножить полученную матрицу на вектор $\vec{h}$.

**Пример** (задача 14 из листка, первый вариант):

$f : (x, y) \to (u, v)$, где $u = xy$, $v = y/x$, $M(1,2)$, $\vec{h} = (1/10,\; 1/100)^T$.

Шаг 1. Матрица Якоби:
$$
J_f =
\begin{pmatrix}
y & x \\\\
-y/x^2 & 1/x
\end{pmatrix}
$$

Шаг 2. Подставляем $M(1,2)$:
$$
J_f(1,2) =
\begin{pmatrix}
2 & 1 \\\\
-2 & 1
\end{pmatrix}
$$

Шаг 3. Умножаем на $\vec{h}$:
$$
df(M, \vec{h}) =
\begin{pmatrix}
2 & 1 \\\\
-2 & 1
\end{pmatrix}
\begin{pmatrix}
1/10 \\\\
1/100
\end{pmatrix}
=
\begin{pmatrix}
2/10 + 1/100 \\\\
-2/10 + 1/100
\end{pmatrix}
=
\begin{pmatrix}
21/100 \\\\
-19/100
\end{pmatrix}
$$

**ЛОВУШКИ:**
- Порядок умножения: матрица слева, вектор справа.
- Вектор $\vec{h}$ должен быть столбцом.

---

### 3. Дифференциал и матрица Якоби композиции $f \circ g$: теоремный подход

**Теорема о дифференцировании композиции:** если $g : \mathbb{R}^m \to \mathbb{R}^n$ дифференцируема в точке $x_0$, $f : \mathbb{R}^n \to \mathbb{R}^k$ дифференцируема в точке $g(x_0)$, то:
$$
(f \circ g)'(x_0) = f'(g(x_0)) \cdot g'(x_0).
$$
В правой части стоит произведение матриц Якоби. Порядок важен: сначала $f'$, потом $g'$.

**Алгоритм:**
1. Определить области определения и значений: $g: \mathbb{R}^m \to \mathbb{R}^n$, $f: \mathbb{R}^n \to \mathbb{R}^k$.
2. Определить размеры матриц: $f'$ будет $k \times n$, $g'$ будет $n \times m$, произведение $(f \circ g)'$ будет $k \times m$.
3. Построить матрицу $g'$: дифференцировать все функции $g$ по всем переменным.
4. Построить матрицу $f'$: дифференцировать все функции $f$ по своим переменным (промежуточным).
5. Перемножить матрицы $f' \cdot g'$.
6. Если задана точка — подставить конкретные значения (в том числе подставить вместо промежуточных переменных $g(x_0)$).

**Пример** (задача 3, вариант: $g : (u,v,w) \to (x,y,z)$, $f : (x,y,z) \to (p,q)$):

$$
g: \; x = u\cos v, \quad y = u\sin v, \quad z = w,
$$
$$
f: \; p = x^2 - yz, \quad q = z^2 - xy.
$$

Шаг 1. $g : \mathbb{R}^3 \to \mathbb{R}^3$, $f : \mathbb{R}^3 \to \mathbb{R}^2$, значит $(f \circ g)' $ имеет размер $2 \times 3$.

Шаг 2. Матрица $g'$ (размер $3 \times 3$):
$$
g' =
\begin{pmatrix}
\cos v & -u\sin v & 0 \\\\
\sin v & u\cos v & 0 \\\\
0 & 0 & 1
\end{pmatrix}
$$

Шаг 3. Матрица $f'$ (размер $2 \times 3$, переменные $x,y,z$):
$$
f' =
\begin{pmatrix}
\dfrac{\partial p}{\partial x} & \dfrac{\partial p}{\partial y} & \dfrac{\partial p}{\partial z} \\\\
\dfrac{\partial q}{\partial x} & \dfrac{\partial q}{\partial y} & \dfrac{\partial q}{\partial z}
\end{pmatrix}
=
\begin{pmatrix}
2x & -z & -y \\\\
-y & -x & 2z
\end{pmatrix}
$$

Шаг 4. $(f \circ g)' = f' \cdot g'$ (размер $2 \times 3$):

Первая строка (производные $p$ по $u, v, w$):
- по $u$: $2x \cdot \cos v + (-z) \cdot \sin v + (-y) \cdot 0 = 2x\cos v - z\sin v$
- по $v$: $2x \cdot (-u\sin v) + (-z) \cdot u\cos v + (-y) \cdot 0 = -2xu\sin v - zu\cos v$
- по $w$: $2x \cdot 0 + (-z) \cdot 0 + (-y) \cdot 1 = -y$

Вторая строка (производные $q$ по $u, v, w$):
- по $u$: $(-y)\cos v + (-x)\sin v + 2z \cdot 0 = -y\cos v - x\sin v$
- по $v$: $(-y)(-u\sin v) + (-x)(u\cos v) + 2z \cdot 0 = yu\sin v - xu\cos v$
- по $w$: $(-y) \cdot 0 + (-x) \cdot 0 + 2z \cdot 1 = 2z$

Итоговая матрица Якоби $(f \circ g)'$:
$$
\begin{pmatrix}
2x\cos v - z\sin v & -u(2x\sin v + z\cos v) & -y \\\\
-y\cos v - x\sin v & u(y\sin v - x\cos v) & 2z
\end{pmatrix}
$$

По желанию подставить $x = u\cos v$, $y = u\sin v$, $z = w$, чтобы выразить через $u,v,w$.

**ЛОВУШКИ:**
- Не перепутать порядок: $(f \circ g)' = f'(g(x)) \cdot g'(x)$, а не наоборот.
- $f'$ вычисляется не в исходной точке $x$, а в промежуточной точке $g(x)$.
- Размер матриц: если $f'$ имеет $k$ строк и $n$ столбцов, то $g'$ должна иметь $n$ строк.

**ПРИЗНАКИ ПРИМЕНИМОСТИ:** задача типа «найти матрицу Якоби $h = f \circ g$», особенно когда функции заданы явно и можно избежать прямой подстановки.

---

### 4. Дифференциал $h = f \circ g$ при произвольной (неизвестной) $f$

**Когда применять:** $f$ — произвольная дифференцируемая функция, явная формула не задана. Требуется выразить $dh$ или частные производные $h$ через $f'$.

**Инвариантность первого дифференциала:** если $f$ дифференцируема, то при любой подстановке аргумента:
$$
d(f \circ g) = f'(g) \cdot dg.
$$
Здесь $f'$ — производная (матрица Якоби) $f$, $dg$ — дифференциал $g$.

**Правило сложной функции (для $f$ от одной переменной):**

Если $h(x,y) = f(g(x,y))$, то:
$$
\frac{\partial h}{\partial x} = f'(g) \cdot \frac{\partial g}{\partial x}, \quad \frac{\partial h}{\partial y} = f'(g) \cdot \frac{\partial g}{\partial y}.
$$

**Правило сложной функции (для $f$ от нескольких переменных $t_1, t_2, \ldots$):**

Если $h = f(t_1(x), t_2(x), \ldots)$, то:
$$
\frac{\partial h}{\partial x_j} = \sum_i \frac{\partial f}{\partial t_i} \cdot \frac{\partial t_i}{\partial x_j}.
$$
Это и есть произведение строки $f'$ на $j$-й столбец матрицы Якоби $g'$.

**Пример** (задача 1 из листка):

$g : (x,y) \to u$, где $u = x^2 + y^2$, $h = f(u)$.

$$
dh = f'(u)\, du = f'(u)\,(2x\,dx + 2y\,dy).
$$

**Пример с двумя промежуточными переменными:**

$g : (x,y) \to (u,v)$, $u = x^2 + y^2$, $v = xy$. Тогда $h(x,y) = f(u,v)$ и:
$$
dh = f'_u\, du + f'_v\, dv = f'_u(2x\,dx + 2y\,dy) + f'_v(y\,dx + x\,dy).
$$
Группируя:
$$
dh = (2x f'_u + y f'_v)\,dx + (2y f'_u + x f'_v)\,dy.
$$

**ЛОВУШКИ:**
- Если у $f$ одна переменная — $f'$ это просто число (обычная производная), не вектор. Пишем $f'(u)$, а не $f'_u$ (хотя оба обозначения допустимы при одной переменной).
- Не забывать подставлять аргумент: $f'$ берётся в точке $g(x,y)$, то есть $f'(x^2+y^2)$, а не просто $f'$.
- Произведение двух функций $y \cdot f$ — дифференцировать по правилу произведения.

**ПРИЗНАКИ ПРИМЕНИМОСТИ:** в условии написано «$f$ — дифференцируемая функция» без указания конкретного выражения; на выходе ответ должен содержать $f'$.

---

### 5. Проверка решения уравнения в частных производных

**Когда применять:** дано уравнение вида $A(x,y)\dfrac{\partial h}{\partial x} + B(x,y)\dfrac{\partial h}{\partial y} = C(x,y)\cdot h$ и семейство функций $h(x,y) = y \cdot f(x^2 - y^2)$. Требуется доказать, что $h$ удовлетворяет уравнению при любой дифференцируемой $f$.

**Алгоритм:**
1. Найти $\dfrac{\partial h}{\partial x}$ и $\dfrac{\partial h}{\partial y}$ (применяя правило сложной функции и произведения).
2. Подставить в левую часть уравнения.
3. Упростить и проверить, что получается правая часть.

**Пример** (задача 2 из листка):

Дано: $h(x,y) = y \cdot f(x^2 - y^2)$. Проверить:
$$
y^2 \frac{\partial h}{\partial x} + xy \frac{\partial h}{\partial y} = xh.
$$

Обозначим $t = x^2 - y^2$.

Шаг 1. Вычислим $\dfrac{\partial h}{\partial x}$:

$h = y \cdot f(t)$, $y$ не зависит от $x$, поэтому:
$$
\frac{\partial h}{\partial x} = y \cdot f'(t) \cdot \frac{\partial t}{\partial x} = y \cdot f'(t) \cdot 2x = 2xy \cdot f'(t).
$$

Шаг 2. Вычислим $\dfrac{\partial h}{\partial y}$:

По правилу произведения:
$$
\frac{\partial h}{\partial y} = 1 \cdot f(t) + y \cdot f'(t) \cdot \frac{\partial t}{\partial y} = f(t) + y \cdot f'(t) \cdot (-2y) = f(t) - 2y^2 f'(t).
$$

Шаг 3. Подставляем в левую часть:
$$
y^2 \cdot 2xy f'(t) + xy \bigl(f(t) - 2y^2 f'(t)\bigr)
= 2xy^3 f'(t) + xy f(t) - 2xy^3 f'(t)
= xy \cdot f(t).
$$

Шаг 4. Правая часть: $xh = x \cdot y \cdot f(t) = xy \cdot f(t)$.

Левая часть равна правой. Уравнение выполнено для любой дифференцируемой $f$.

**ЛОВУШКИ:**
- При дифференцировании $y \cdot f(t)$ по $y$: обязательно применять правило произведения — $y$ тоже зависит от $y$.
- Слагаемые с $f'(t)$ часто сокращаются — это нормально и ожидаемо.

---

## Разбор задач

### Задача: якобиан полярных координат (задача 13)

**Условие:** $f : (\rho, \varphi) \to (x,y)$, $x = \rho\cos\varphi$, $y = \rho\sin\varphi$.

**Решение:**

$$
J_f =
\begin{pmatrix}
\cos\varphi & -\rho\sin\varphi \\\\
\sin\varphi & \rho\cos\varphi
\end{pmatrix}
$$

$$
\det J_f = \cos\varphi \cdot \rho\cos\varphi - (-\rho\sin\varphi) \cdot \sin\varphi = \rho\cos^2\varphi + \rho\sin^2\varphi = \rho.
$$

**Ответ:** $\det J_f = \rho$.

**Геометрический смысл:** $\rho$ — коэффициент изменения площади при переходе от полярных координат к декартовым. При $\rho = 0$ — точка особая (начало координат).

---

### Задача: проверка уравнения в частных производных (задача 2)

**Условие:** $h(x,y) = y \cdot f(x^2 - y^2)$, $f$ — произвольная дифференцируемая функция. Доказать:
$$y^2 \frac{\partial h}{\partial x} + xy \frac{\partial h}{\partial y} = xh.$$

**Решение:** разобрано полностью в методе 5 выше.

**Ответ:** тождество верно для любой дифференцируемой $f$.

---

### Задача: матрица Якоби композиции $h = f \circ g$ (задача 3)

**Условие:** $g : (u,v,w) \to (x,y,z)$: $x = u\cos v$, $y = u\sin v$, $z = w$. $f : (x,y,z) \to (p,q)$: $p = x^2 - yz$, $q = z^2 - xy$. Найти $J_{f \circ g}$.

**Решение:** разобрано полностью в методе 3 выше.

**Размер ответа:** матрица $2 \times 3$.

---

### Задача: дифференциал $h = f \circ g$ при произвольной $f$ и $g : (x,y) \to (u,v)$ (задача 1)

**Условие:** $g : (x,y) \to (u,v)$, $u = x^2 + y^2$, $v = xy$. Найти $dh = d(f \circ g)$.

**Решение:**

$$
du = 2x\,dx + 2y\,dy, \quad dv = y\,dx + x\,dy.
$$

По инвариантности первого дифференциала:
$$
dh = f'_u \, du + f'_v \, dv = f'_u(2x\,dx + 2y\,dy) + f'_v(y\,dx + x\,dy).
$$

Группируем:
$$
\boxed{dh = (2x f'_u + y f'_v)\,dx + (2y f'_u + x f'_v)\,dy.}
$$

---

### Задача: $h = f \circ g$, $g : (x,y,z) \to u$, $u = x^2 + y^2 + z^2$ (задача 1, другой вариант)

**Условие:** $u = x^2 + y^2 + z^2$, $h = f(u)$. Найти $dh$.

**Решение:**
$$
du = 2x\,dx + 2y\,dy + 2z\,dz.
$$
$$
dh = f'(u)\,du = f'(u)\,(2x\,dx + 2y\,dy + 2z\,dz).
$$
$$
\boxed{dh = 2f'(u)\,(x\,dx + y\,dy + z\,dz).}
$$

---

## Справочный лист

**Матрица Якоби** $f : \mathbb{R}^m \to \mathbb{R}^n$, строки — функции, столбцы — переменные:
$$
J_f = \left(\frac{\partial f_i}{\partial x_j}\right), \quad i = 1\ldots n,\; j = 1\ldots m.
$$
Размер: $n \times m$.

**Якобиан** — $\det J_f$; существует только при $m = n$.

**Полярные координаты:** $x = \rho\cos\varphi$, $y = \rho\sin\varphi$. Якобиан $= \rho$.

**Сферические координаты:** $x = r\cos\varphi\sin\theta$, $y = r\sin\varphi\sin\theta$, $z = r\cos\theta$. Якобиан $= r^2\sin\theta$.

**Производная композиции:**
$$(f \circ g)'(x) = f'(g(x)) \cdot g'(x).$$
Порядок: сначала $f'$, потом $g'$.

**Дифференциал в точке на векторе:**
$$df(M, \vec{h}) = J_f(M) \cdot \vec{h}.$$

**Правило сложной функции ($f$ от $t_1, \ldots, t_k$; каждое $t_i$ от $x_1,\ldots,x_m$):**
$$\frac{\partial(f \circ g)}{\partial x_j} = \sum_{i=1}^{k} \frac{\partial f}{\partial t_i} \cdot \frac{\partial t_i}{\partial x_j}.$$

**Инвариантность первого дифференциала:** $df = f'_u\,du$ независимо от того, $u$ — независимая переменная или функция.

**Дифференциал произведения:** $d(u\cdot v) = v\,du + u\,dv$.

---

## Типичные ошибки семинара

1. **Перепутан порядок в произведении матриц:** $(f \circ g)' = f' \cdot g'$, а не $g' \cdot f'$.

2. **Аргумент $f'$ взят неверно:** $f'$ нужно вычислять в промежуточной точке $g(x)$, а не в исходной точке $x$.

3. **Не применено правило произведения** при дифференцировании $y \cdot f(t)$ по $y$: нельзя просто писать $y \cdot f'(t) \cdot t'_y$, нужно добавить $1 \cdot f(t)$.

4. **Перепутаны якобиан и матрица Якоби:** якобиан — это число (определитель), матрица Якоби — матрица.

5. **Неверная запись матрицы:** строки соответствуют функциям (выходам), столбцы — переменным (входам), не наоборот.

6. **Неверный размер результирующей матрицы:** при перемножении $k \times n$ на $n \times m$ получается $k \times m$; если размеры не совпадают — ошибка в постановке.

7. **Забыт множитель $(-2y)$** при $\dfrac{\partial}{\partial y}(x^2 - y^2) = -2y$ — частая ошибка при дифференцировании аргумента.

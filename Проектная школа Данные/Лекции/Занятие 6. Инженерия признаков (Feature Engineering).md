[[Lecture 6. Feature Engineering Pt. 2 Final.pdf]]
## Конспект занятия: Инженерия признаков (Feature Engineering)

### I. Практическая часть: Инженерия признаков для табличных данных (Цены на дома)

На занятии продолжалась работа с набором данных по оценке стоимости домов. **Целевая переменная** (то, что нужно предсказать) — это цена дома.

#### A. Анализ числовых признаков (Numerical Features)

1. **Отбор признаков:** Числовые столбцы отбираются с помощью фильтрации по типу данных, например, используя числовые типы из библиотеки NumPy.
2. **Корреляционный анализ:** Позволяет оценить взаимосвязь между числовыми признаками (например, площадью, количеством комнат) и целевой переменной (ценой).
    - **Пояснение:** Корреляция — это число от **-1 до +1**.
        - **+1 (прямая сильная связь):** Чем больше один признак (например, площадь), тем больше другой (цена).
        - **-1 (обратная сильная связь):** Чем больше один признак (например, уровень загрязнения), тем меньше другой (цена).
        - **0 (нет связи):** Признаки бесполезны для линейной модели.
3. **Визуализация:** Матрица корреляции часто представляется в виде **тепловой карты (HitMap)**, где сила связи отображается цветом и числом.

#### B. Анализ категориальных признаков (Categorical Features)

Категориальные признаки (например, наличие мебели, подъездная дорога) обычно хранятся в виде текста (тип данных `object` или строка). Модели машинного обучения не могут напрямую работать с текстом, поэтому их необходимо кодировать.

1. **Бинарное кодирование (Binary Encoding):**
    - **Применение:** Используется для признаков, имеющих только два уникальных значения (например, "Yes/No", "True/False").
    - **Преобразование:** Значения кодируются числами, чаще всего **1 (для "Yes") и 0 (для "No")**.
    - **Пояснение:** Если признак имеет только одно уникальное значение (константа), он бесполезен, так как не несет информации.
2. **One-Hot Encoding (OHE):**
    - **Применение:** Используется для признаков с несколькими уникальными категориями (например, статус меблировки: "furnished", "semi-furnished", "unfurnished").
    - **Преобразование:** Создается новый бинарный столбец для каждой категории. Если исходная запись попадает в категорию, она получает 1, в противном случае — 0.

#### C. Создание признаков взаимодействия (Interaction Features)

Признаки взаимодействия создаются путем объединения или расчета соотношений между исходными признаками, например, Площадь / Количество комнат (`Area Per Room`).

- **Критическое правило (Утечка данных):** **Нельзя** использовать целевую переменную (цену) для расчета признаков, которые затем будут использоваться для предсказания этой цены.
    - **Пояснение:** Если мы создадим признак "цена за метр", а потом попытаемся предсказать цену дома, это будет "предсказание цены по цене", что даст ложно высокое качество модели на тренировочных данных. Но для новых домов, чья цена неизвестна, такой признак посчитать будет невозможно, и прогноз сильно ухудшится.

### II. Теоретическая часть: Инженерия признаков для временных рядов

#### A. Что такое временной ряд (ВР)?

Временной ряд — это **последовательность наблюдений, упорядоченных во времени**. Каждое наблюдение связано с конкретной временной меткой.

- **Ключевая особенность:** **Порядок наблюдений критичен.** Нельзя произвольно перемешивать точки данных, так как это нарушит логику развития переменной во времени.
- **Примеры:** Цены акций, курсы валют, показания датчиков, продажи.

#### B. Компоненты временного ряда

Временной ряд можно разложить (декомпозировать) на три составляющие для лучшего понимания его структуры:

1. **Тренд (Trend):** **Долгосрочное направление изменения** (рост, падение или стабильность).
    - **Пояснение:** Общая, глобальная тенденция, если отбросить все мелкие колебания.
2. **Сезонность (Seasonality):** **Регулярные, повторяющиеся паттерны с фиксированной периодичностью** (например, дневной, недельной, годовой).
    - **Пояснение:** Предсказуемые циклы. Например, увеличение трафика в выходные или рост продаж перед Новым годом.
3. **Случайный шум (Noise):** **Непредсказуемые, случайные колебания**, не объясненные трендом или сезонностью.
    - **Пояснение:** Остатки, хаотичные скачки, вызванные внешними, нерегулярными факторами (например, внезапные новости или аномальные погодные явления).
    - Формула: $Y(t) = \text{Тренд}(t) + \text{Сезонность}(t) + \text{Шум}(t)$.

#### C. Ключевые свойства временных рядов

1. **Стационарность (Stationarity):** Временной ряд стационарен, если его **статистические свойства (среднее, дисперсия, автокорреляция) не изменяются во времени**.
    - **Пояснение:** Статистический "портрет" ряда всегда одинаков, независимо от того, в какой период вы на него смотрите. Стационарные ряды проще прогнозировать.
2. **Автокорреляция (Autocorrelation):** **Корреляция временного ряда с самим собой**, сдвинутым на определенное количество периодов, называемое **лагом**.
    - **Пояснение:** Насколько сильно текущее значение **зависит от прошлых значений** (например, насколько цена сегодня зависит от цены вчера или неделю назад).

#### D. Категории признаков для временных рядов

Современные методы машинного обучения требуют **явного создания признаков** для захвата временных зависимостей, трендов и сезонности, что может повысить точность прогнозов на 20–30%.

1. **Лаговые признаки (Lag Features):**
    - **Суть:** Использование прошлых значений ряда в качестве предикторов.
    - **Пояснение:** Признаки создаются путем **сдвига значений ряда назад** на определенное количество периодов (лаг). Например, модель может использовать цену биткоина 1, 7 и 30 дней назад для прогноза текущей цены.
    - **Применение:** Захватывают автокорреляцию и позволяют модели "помнить" историю.
2. **Скользящие статистики (Rolling Statistics):**
    - **Суть:** Вычисление агрегированных метрик (среднее, стандартное отклонение, минимум, максимум) в **скользящем окне фиксированного размера**.
    - **Пояснение:** Окно "скользит" по ряду. Например, **скользящее среднее** помогает отфильтровать краткосрочные колебания и выявить общий **тренд**. **Скользящее стандартное отклонение** измеряет волатильность (меру риска).
3. **Разностные признаки (Difference Features):**
    - **Суть:** Вычисление **изменений** между текущим и предыдущим значением (абсолютное или процентное).
    - **Пояснение:** Помогают преобразовать нестационарные ряды в стационарные, а процентное изменение особенно полезно для финансовых данных, поскольку нормализует динамику.
4. **Временные / Циклические признаки (Time-based / Cyclical Features):**
    - **Суть:** Извлечение компонентов из даты (день недели, месяц, квартал).
    - **Циклическое кодирование:** Использует тригонометрические функции **синуса и косинуса** для сохранения **периодической природы времени**.
    - **Пояснение:** Обычное числовое кодирование (0-23 часа) не учитывает, что 23:00 и 00:00 находятся рядом. Тригонометрическое преобразование "наматывает" время на единичную окружность, делая начало и конец цикла математически близкими.

---

**Аналогия для интуитивного понимания временных рядов:**

Представьте, что вы анализируете ежегодный график продаж мороженого (временной ряд).

- **Тренд** — это, если продажи из года в год медленно растут из-за роста населения.
- **Сезонность** — это пик продаж каждое лето (ежегодный цикл) и спад каждую зиму.
- **Шум** — это внезапный скачок продаж в один жаркий день в октябре, который не был предсказан.

**Инженерия признаков** — это когда вы берете этот график и создаете "подсказки" для модели:

1. **Лаг (Lag)**: "Вчерашние продажи были X".
2. **Скользящее среднее (Rolling Mean)**: "Средние продажи за последние 30 дней были Y" (указывает на текущий локальный тренд).
3. **Циклический признак**: "Сейчас шестой месяц (июнь), закодированный так, что он близко к маю и июлю, а не далеко от января".

### 1. Основные определения и понятия

Для работы с потоками вводится понятие **транспортной сети** — ориентированного графа, где для каждого ребра задана **пропускная способность** $C$.

- **Остаточная пропускная способность ($C_f$):** величина, показывающая, сколько еще «места» осталось в ребре сверх уже пущенного потока $f$. Она рассчитывается как разность между максимальной пропускной способностью и текущим потоком: $C_f(u, v) = C(u, v) - f(u, v)$.
- **Остаточная сеть (остаточный граф):** граф, в котором веса ребер равны их остаточным пропускным способностям.
- **Закон сохранения потока:** Для всех вершин, кроме истока ($S$) и стока ($T$), сумма входящего потока должна быть равна сумме исходящего. В источниках упоминается **антисимметричная функция** как более удобный способ записи этого правила: поток из $u$ в $v$ равен отрицательному потоку из $v$ в $u$.
- **Увеличивающий (дополняющий) путь:** Маршрут из истока $S$ в сток $T$ в остаточной сети, где все ребра имеют строго положительную остаточную пропускную способность ($C_f > 0$).

> **Интуиция:** Представьте транспортную сеть как систему труб. Поток — это вода. Остаточный граф показывает, по каким трубам еще можно пропустить дополнительный объем воды и в каком количестве, прежде чем они «забьются».

---

### 2. Лемма о максимальном потоке и увеличивающем пути

**Формулировка:** Если поток $f$ максимален, то в остаточной сети не существует увеличивающего пути из истока $S$ в сток $T$.

**Подробное доказательство (от противного):**

1. Предположим обратное: поток $f$ максимален, но существует увеличивающий путь из $S$ в $T$.
2. На этом пути каждое ребро имеет остаточную пропускную способность $C_f > 0$.
3. Выберем среди этих ребер то, у которого $C_f$ минимальна. Назовем эту величину $M$ ($M = \min {C_f(u_i, u_{i+1})}$).
4. Поскольку все $C_f > 0$ на пути, то и $M > 0$.
5. Мы можем увеличить поток вдоль всего этого пути на величину $M$. При этом в каждом ребре пути новый поток $f' = f + M$ все еще не превысит пропускную способность $C$ (так как $M$ — это минимум остаточных мощностей).
6. В результате общая величина потока из $S$ вырастет на $M$.
7. **Противоречие:** Мы нашли способ увеличить «максимальный» поток, значит, исходное предположение о его максимальности при наличии пути было ложным.

---

### 3. Лемма о существовании маршрута при положительном потоке

**Формулировка:** Если величина максимального потока больше нуля, то существует маршрут из $S$ в $T$, проходящий только по ребрам с положительной пропускной способностью.

**Подробное доказательство:**

1. Из истока $S$ выходит поток величиной $|f| > 0$. Значит, существует хотя бы одно ребро $(S, v)$, где поток $f(S, v) > 0$.
2. Поскольку $f \le C$, пропускная способность $C(S, v)$ этого ребра также положительна.
3. Рассмотрим вершину $v$. Если это не сток $T$, то по закону сохранения потока (вход = выход) из неё должно выходить столько же потока, сколько вошло.
4. Так как вошло положительное количество, должно выйти тоже положительное количество хотя бы по одному ребру $(v, w)$.
5. Повторяем этот процесс. Так как количество вершин конечно и в транспортной сети из любой вершины достижим сток, мы либо дойдем до $T$, либо обнаружим цикл (но в транспортной сети мы всегда можем достичь стока).
6. В итоге мы построим путь от $S$ до $T$, где на каждом ребре $f > 0$ и $C > 0$.

---

### 4. Алгоритм Форда-Фалкерсона

Алгоритм предназначен для нахождения максимального потока.

**Ход алгоритма:**

1. Изначально все потоки $f$ в ребрах равны нулю.
2. Ищем в остаточном графе **любой** увеличивающий путь из $S$ в $T$ (например, с помощью DFS или BFS).
3. Находим на этом пути ребро с минимальной остаточной мощностью $M$.
4. «Наливаем» поток $M$ вдоль этого пути: прибавляем $M$ к текущему потоку вдоль пути и вычитаем $M$ из остаточных мощностей.
5. Для возможности «отката» неудачных решений пускаем обратные ребра в остаточной сети.
6. Повторяем шаги 2–5 до тех пор, пока в остаточной сети не останется ни одного пути из $S$ в $T$.

**Сложность:** В худшем случае алгоритм работает за $O(E \cdot |f|)$, где $E$ — количество ребер, а $|f|$ — величина максимального потока. Если использовать простой DFS, грубая оценка может достигать $O(N^4)$.

---

### 5. Теорема Форда-Фалкерсона (о максимальном потоке и минимальном разрезе)

Это ключевая теорема, утверждающая эквивалентность трех условий:

1. Поток $f$ максимален.
2. В остаточном графе нет пути из $S$ в $T$.
3. Величина потока $|f|$ равна пропускной способности некоторого разреза $(S, T)$.

**Доказательство (переход 2 $\implies$ 3):**

1. Пусть в остаточном графе нет пути из $S$ в $T$.
2. Разделим все вершины графа на два множества: $S'$ (вершины, достижимые из $S$ в остаточном графе) и $T'$ (все остальные вершины, включая сток $T$).
3. Это разделение является **разрезом**.
4. Рассмотрим любое ребро $(u, v)$, идущее из $S'$ в $T'$. Раз $v$ не попала в $S'$, значит, в остаточном графе ребра $(u, v)$ с $C_f > 0$ не существует.
5. Это возможно только если текущий поток $f(u, v)$ полностью заполнил пропускную способность: $f(u, v) = C(u, v)$.
6. Для ребер, идущих обратно из $T'$ в $S'$, поток должен быть равен нулю (иначе было бы прямое ребро в остаточной сети).
7. Следовательно, суммарный поток через разрез равен сумме пропускных способностей ребер этого разреза.
8. Так как поток через любой разрез всегда не больше его пропускной способности, мы нашли минимальный разрез, и текущий поток равен его величине, а значит, он максимален.

> **Интуиция:** Разрез — это «узкое горлышко» графа. Теорема говорит о том, что вы не можете пропустить через систему труб больше воды, чем способна пропустить самая узкая часть этой системы, полностью перекрывающая путь от истока к стоку.

---

**Метафора для закрепления:** Представьте, что вы организуете движение колонны машин по дорогам с разной пропускной способностью (количеством полос). Алгоритм Форда-Фалкерсона — это поиск любой свободной дорожки от старта до финиша. Как только вы заполнили все возможные маршруты так, что в каждом из них появилось хотя бы одно «забитое» пробкой ребро, вы достигли предела возможностей вашей дорожной сети. Это «забитое» место и будет частью минимального разреза.